{"version":3,"sources":["../src/States.js"],"names":[],"mappings":"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","file":"States.js","sourcesContent":["import {buildUiRouterState, mountAt, State} from 'fd-angular-core';\nimport {I18n} from './index';\n\nlet $current = Symbol('$current');\nlet $translations = Symbol('$translations');\n\n/**\n@function mountI18n\n@param {State} child\n@example\nbootstrap(mountI18n(AppController));\n*/\nexport function mountI18n(child) {\n\treturn {\n\t\tchild:              child,\n\t\tbuildUiRouterState: build,\n\t};\n\n\tfunction build(options) {\n\t\tlet children = [];\n\n\t\tchildren.push(mountI18nLocale($current, this.child));\n\t\tfor (let locale of I18n.locales) {\n\t\t\tchildren.push(mountI18nLocale(locale, this.child));\n\t\t}\n\n\t\tchildren = children.map(c => buildUiRouterState(c, options));\n\n\t\treturn {\n\t\t\tname:        'i18n',\n\t\t\tabstract:    true,\n\t\t\thiddenState: true,\n\t\t\tchildren:    children,\n\t\t};\n\t}\n}\n\nfunction mountI18nLocale(locale, child) {\n\tlet url = '/', name = 'i18n.$current';\n\tif (locale !== $current) {\n\t\turl = `/${locale}`;\n\t\tname = `i18n.${locale}`;\n\t}\n\n\treturn {\n\t\tstate:  I18nController::mountAt(url, { name }),\n\t\tlocale: locale,\n\t\tchild:  child,\n\t\tbuild:  build,\n\t};\n\n\tfunction build(options) {\n\t\toptions = Object.create(options, {});\n\t\tif (this.locale === $current) {\n\t\t\toptions.locale = null;\n\t\t} else {\n\t\t\toptions.locale = this.local;\n\t\t}\n\n\t\tlet state = buildUiRouterState(this.state, options);\n\n\t\t// add resolve\n\t\tif (!state.resolve) {\n\t\t\tstate.resolve = {};\n\t\t}\n\t\tif (this.locale === $current) {\n\t\t\tstate.resolve.$locale = () => { return I18n.current; };\n\t\t} else {\n\t\t\tstate.resolve.$locale = () => { return this.locale; };\n\t\t}\n\t\tstate.resolve.$translations = ['$locale', function($locale) { return I18n.fetch($locale); }];\n\n\t\t// add children\n\t\tif (!state.children) {\n\t\t\tstate.children = [];\n\t\t}\n\t\tstate.children.push(buildUiRouterState(this.child, options));\n\n\t\treturn state;\n\t}\n}\n\n@State({\n\thidden:   true,\n\tbindTo:   'I18n',\n\ttemplate: `<ui-view></ui-view>`,\n})\n@Inject('$translations', '$locale')\nclass I18nController {\n\n\tconstructor(translations, locale) {\n\t\tthis[$current] = locale;\n\t\tthis[$translations] = translations;\n\t}\n\n\tget current() {\n\t\treturn this[$current];\n\t}\n\n\tget locales() {\n\t\treturn I18n.locales;\n\t}\n\n\t/**\n\tThe current translated keys (only available in localised states, when injected as a service)\n\n\t@var {Object} t\n\t@memberof I18n\n\t*/\n\tget t() {\n\t\treturn this[$translations];\n\t}\n\n}\n"]}